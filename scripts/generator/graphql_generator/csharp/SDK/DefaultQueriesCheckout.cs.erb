namespace <%= namespace %>.SDK {
    using System;
    using System.Collections.Generic;
    using <%= namespace %>.GraphQL;

    public class DefaultQueriesCheckout {
        public void Create(MutationQuery query, List<CheckoutLineItemInput> lineItems) {
            query.checkoutCreate(
                buildQuery: checkoutCreate => checkoutCreate
                    .checkout(checkout => {
                        Checkout(checkout);
                        CheckoutLineItems(checkout);
                    })
                    .userErrors(userErrors => userErrors
                        .field()
                        .message()
                    ),
                input: new CheckoutCreateInput(
                    lineItems: lineItems
                )
            );
        }

        public void Poll(QueryRootQuery query, string checkoutId) {
            query.node(
                buildQuery: node => node
                    .onCheckout(checkout => Checkout(checkout)),
                id: checkoutId
            );
        }

        public void LineItemsRemove(MutationQuery query, string checkoutId, List<string> lineItemIds) {
            query.checkoutLineItemsRemove(
                buildQuery: lineItemRemove => lineItemRemove
                    .userErrors(userErrors => userErrors
                        .field()
                        .message()
                    ),
                checkoutId: checkoutId,
                lineItemIds: lineItemIds
            );
        }

        public void LineItemsAdd(MutationQuery query, string checkoutId, List<CheckoutLineItemInput> lineItems) {
            query.checkoutLineItemsAdd(
                buildQuery: lineItemAdd => lineItemAdd
                    .checkout(checkout => {
                        Checkout(checkout);
                        CheckoutLineItems(checkout);
                    })
                    .userErrors(userErrors => userErrors
                        .field()
                        .message()
                    ),
                checkoutId: checkoutId,
                lineItems: lineItems
            );
        }

        public void CheckoutLineItemsPage(QueryRootQuery query, string checkoutId, int first = 250, string after = null) {
            query.node(
                buildQuery: node => node.onCheckout(checkout => CheckoutLineItems(checkout, first, after)),
                id: checkoutId
            );
        }

        public void ShippingAddressUpdate(MutationQuery query, string checkoutId, MailingAddressInput shippingAddress) {
            query.checkoutShippingAddressUpdate(
                buildQuery: shippingAddressUpdate => shippingAddressUpdate
                    .checkout(checkout => Checkout(checkout)
                        .availableShippingRates(availableShippingRates => AvailableShippingRates(availableShippingRates))
                    )
                    .userErrors(userErrors => userErrors
                        .field()
                        .message()
                    ),
                shippingAddress: shippingAddress,
                checkoutId: checkoutId
            );
        }

        public void EmailUpdate(MutationQuery query, string checkoutId, String email) {
            query.checkoutEmailUpdate(
                buildQuery: emailUpdate => emailUpdate
                    .checkout(checkout => checkout
                        .email())
                    .userErrors(userErrors => userErrors
                        .field()
                        .message()
                ),
                checkoutId: checkoutId,
                email: email
            );
        }

        public void ShippingLineUpdate(MutationQuery query, string checkoutId, String shippingRateHandle) {
            query.checkoutShippingLineUpdate(
                buildQuery: emailUpdate => emailUpdate
                    .checkout(checkout => Checkout(checkout)
                        .shippingLine(shippingLine => ShippingRate(shippingLine)))
                    .userErrors(userErrors => userErrors
                        .field()
                        .message()
                    ),
                checkoutId: checkoutId,
                shippingRateHandle: shippingRateHandle
            );
        }

        private CheckoutQuery Checkout(CheckoutQuery checkout) {
            return checkout
                .id()
                .webUrl()
                .requiresShipping()
                .subtotalPrice()
                .totalTax()
                .totalPrice()
                .ready();
        }

        private ShippingRateQuery ShippingRate(ShippingRateQuery shippingRate) {
            return shippingRate
                .handle()
                .title()
                .price();
        }

        private CheckoutQuery CheckoutLineItems(CheckoutQuery checkout, int first = 250, string after = null) {
            return checkout.lineItems(
                buildQuery: lineItems => lineItems
                    .edges(edge => edge
                        .node(node => node
                            .id()
                            .variant(variant => variant
                                .id()
                            )
                        )
                        .cursor()
                    )
                    .pageInfo(pageInfo => pageInfo
                        .hasNextPage()
                    ),
                first: first,
                after: after
            );
        }

        private AvailableShippingRatesQuery AvailableShippingRates(AvailableShippingRatesQuery availableShippingRates) {
            return availableShippingRates
                .shippingRates(
                    buildQuery: shippingRate => ShippingRate(shippingRate)
                )
                .ready();
        }
    }
}
