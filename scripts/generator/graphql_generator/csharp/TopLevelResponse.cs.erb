namespace <%= namespace %> {
    using System;
    using System.Collections.Generic;

    public class TopLevelResponse {
        internal const string KEY_DATA = "data";
        internal const string KEY_ERRORS = "errors";

        public Dictionary<string,object> data {
            get {
                return _data;
            }
        }

        public List<Exception> errors {
            get {
                return _errors;
            }
        }

        private Dictionary<string,object> _data;
        private List<Exception> _errors;

        public TopLevelResponse(Dictionary<string,object> dataJSON) {
            object errors;
            object data;

            dataJSON.TryGetValue(KEY_ERRORS, out errors);
            dataJSON.TryGetValue(KEY_DATA, out data);

            if (errors != null) {
                ParseErrors((Dictionary<string,object>) dataJSON);
            } else if (data != null) {
                _data = (Dictionary<string,object>) data;
            } else {
                throw new InvalidServerResponseException();
            }
        }

        private void ParseErrors(Dictionary<string,object> dataJSON) {
            _errors = new List<Exception>();

            // there are cases where the returned errors are not an Array but are a string
            // instead. This conditional handle this.
            if (dataJSON[KEY_ERRORS] is string) {
                _errors.Add(new Exception((string) dataJSON[KEY_ERRORS]));
            } else {
                List<object> errorsJSON = (List<object>) dataJSON[KEY_ERRORS];

                foreach(Dictionary<string,object> error in errorsJSON) {
                    _errors.Add(new Exception((string) error["message"]));
                }
            }
        }
    }
}
